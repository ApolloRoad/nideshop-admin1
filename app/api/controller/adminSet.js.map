{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\api\\controller\\adminSet.js"
    ],
    "names": [
        "fs",
        "require",
        "path",
        "rename",
        "think",
        "promisify",
        "module",
        "exports",
        "Controller",
        "admincategorySetAction",
        "oPost",
        "post",
        "result",
        "type",
        "goodsMax",
        "model",
        "max",
        "res",
        "where",
        "parent_id",
        "page",
        "countSelect",
        "sues",
        "add",
        "objs",
        "oId",
        "deleteInfo",
        "id",
        "delete",
        "goodsList",
        "category_id",
        "categoryId",
        "success",
        "adminAddGoodAction",
        "goodObj",
        "list_pic_url",
        "config",
        "goods_sn",
        "str",
        "i",
        "Uploadimg1",
        "length",
        "goods_desc",
        "goods_number",
        "goodSet",
        "productId",
        "sobj",
        "goods_id",
        "retail_price",
        "adminDelGoodAction",
        "goodId",
        "get",
        "adminGoodsAction",
        "adminUploadAction",
        "thisId",
        "file",
        "name",
        "split",
        "filepath",
        "join",
        "ROOT_PATH",
        "filesName",
        "galleryMax",
        "img_url",
        "sort_order",
        "fileName",
        "adminListAction",
        "orderList",
        "newOrderList",
        "item",
        "data",
        "order_id",
        "select",
        "goodsCount",
        "forEach",
        "v",
        "number",
        "order_status_text",
        "getOrderStatusText",
        "handleOption",
        "getOrderHandleOption",
        "push"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\api\\controller\\adminSet.js",
    "sourcesContent": [
        "/* eslint-disable no-multi-spaces */\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst rename = think.promisify(fs.rename, fs); // 通过 promisify 方法把 rename 方法包装成 Promise 接口\r\nmodule.exports = class extends think.Controller {\r\n\t//分类查询修改删除\r\n\tasync admincategorySetAction() {\r\n\t\tconst oPost = this.post('oPost');\r\n\t\tlet result = null;\r\n\t\tif(oPost.type == 'chack')\r\n\t\t{\r\n\t\t\tconst goodsMax = await this.model('category').max('id'); //最大分类 id\r\n\t\t\tconst res = await this.model('category').where({ parent_id: '1005000' }).page(1, 100).countSelect();\r\n\t\t\tresult = {res:res,goodsMax:goodsMax};\r\n\t\t}\r\n\t\telse if(oPost.type == 'add')\r\n\t\t{\r\n\t\t\tconst sues = await this.model('category').add(oPost.objs);\r\n\t\t\tresult = sues;\r\n\t\t}\r\n\t\telse if(oPost.type == 'del')\r\n\t\t{\r\n\t\t\tconst oId = oPost.oId;\r\n\t\t\tconst deleteInfo = await this.model('category').where({ id: oId }).delete();\r\n    \t\tresult = deleteInfo;\r\n\t\t}\r\n\t\telse if(oPost.type == 'checkgoods')\r\n\t\t{\r\n\t\t\tconst goodsList = await this.model('goods').where({ category_id: oPost.categoryId }).page(1, 100).countSelect();\r\n\t\t\tresult = goodsList;\r\n\t\t}\r\n\r\n\t\treturn this.success(result);\r\n\t}\r\n\t//添加商品\r\n\tasync adminAddGoodAction() {\r\n\t\tconst goodObj = this.post('forms');\r\n\t\tgoodObj.list_pic_url = this.config('rootStatic') + goodObj.list_pic_url;\r\n\t\tgoodObj.goods_sn = goodObj.id;\r\n\t\tlet str = '';\r\n\t\tfor(var i = 1 ; i< goodObj.Uploadimg1.length ;i++)\r\n\t\t{\r\n\t\t\tstr += \"<p><img src='\" + this.config('rootStatic') + goodObj.Uploadimg1[i] + \"' _src='\" + this.config('rootStatic') + goodObj.Uploadimg1[i] + \"' /></p>\";\r\n\t\t}\r\n\t\tstr += \"<p><br/></p>\";\r\n\t\tgoodObj.goods_desc = str;\r\n\t\tgoodObj.goods_number = 1000;\r\n\t\tdelete goodObj.Uploadimg1;\r\n\r\n\t\tconst goodSet = await this.model('goods').add(goodObj);\r\n\t\t//product\r\n\t\tconst productId = await this.model('product').max('id') + 1;\r\n\t\tconst sobj = {\r\n\t\t\tid:productId,\r\n\t\t\tgoods_id: goodObj.id,\r\n\t\t\tgoods_sn: goodObj.id,\r\n\t\t\tgoods_number: 1000,\r\n\t\t\tretail_price: goodObj.retail_price\r\n\t\t}\r\n\t\tconst sues = await this.model('product').add(sobj);\r\n\t\treturn this.success(sues);\r\n\t}\r\n\r\n\t//删除商品\r\n\tasync adminDelGoodAction() {\r\n\t\tconst goodId = this.get('goodId');\r\n\t\tconst deleteInfo = await this.model('goods').where({ id: goodId }).delete();\r\n    \treturn this.success(deleteInfo);\r\n\t}\r\n\t//商品查询\r\n\tasync adminGoodsAction() {\r\n\t\tconst goodsMax = await this.model('goods').max('id'); //最大good id\r\n\t\tconst goodsList = await this.model('goods').page(1, 100).countSelect();\r\n\t\treturn this.success({goodsMax:goodsMax,goodsList:goodsList});\r\n\t}\r\n\t//上传图片\r\n\tasync adminUploadAction() {\r\n\t\tconst thisId = this.post('id');\r\n\t\tconst file = this.file('file');\r\n\t\tconst name = file.path.split('temp\\\\')[1];\r\n\t\tconst filepath = path.join(think.ROOT_PATH, 'www/static/upload/'+name);\r\n\t\tconst filesName =  filepath.split(\"upload\\\\\")[1];\r\n\t      //think.mkdir(path.dirname(filepath));\r\n\t      await rename(file.path, filepath);\r\n\t    if(thisId !== 'undefined')\r\n\t    {\r\n\t    \tconst galleryMax = await this.model('goods_gallery').max('id');\r\n\t   \t\tawait this.model('goods_gallery').add({id:galleryMax + 1, goods_id: thisId,img_url: this.config('rootStatic') + filesName,sort_order:5});\r\n\t    }\r\n\t    \r\n\t\treturn this.success({fileName:filepath});\r\n\t}\r\n\r\n\t//所有订单\r\n\tasync adminListAction() {\r\n    const orderList = await this.model('order').page(1, 10000).countSelect();\r\n    const newOrderList = [];\r\n    for (const item of orderList.data) {\r\n      // 订单的商品\r\n      item.goodsList = await this.model('order_goods').where({ order_id: item.id }).select();\r\n      item.goodsCount = 0;\r\n      item.goodsList.forEach(v => {\r\n        item.goodsCount += v.number;\r\n      });\r\n\r\n      // 订单状态的处理\r\n      item.order_status_text = await this.model('order').getOrderStatusText(item.id);\r\n\r\n      // 可操作的选项\r\n      item.handleOption = await this.model('order').getOrderHandleOption(item.id);\r\n\r\n      newOrderList.push(item);\r\n    }\r\n    orderList.data = newOrderList;\r\n\r\n    return this.success(orderList);\r\n  }\r\n}"
    ]
}